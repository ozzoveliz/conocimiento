jQuery(document).ready(function(e){function a(){e("#amgp_license_check").html("");i("GET",{action:"amgp_handle_license_request",command:"get_license_info"},"Retrieving license status. Please wait.")}function i(a,i,o){var t;e(".eckb-top-notice-message").html(""),e.ajax({type:a,dataType:"json",data:i,url:ajaxurl,beforeSend:function(e){n("show",o)}}).done(function(a){if((a=a||"").message||void 0===a.output)t=a.message?a.message:g("","KB Groups: Error occurred. Please try again later. (L01)","error");else{var i=void 0!==a.output&&a.output?a.output:g("","Please reload the page and try again (L37).","error");e("#amgp_license_check").html(i)}}).fail(function(e,a,i){t=g("KB Groups: Error occurred. Please try again later. (L02)",t=i?" ["+i+"]":"unknown error","error")}).always(function(){n("remove",""),t&&(e(".eckb-top-notice-message").remove(),e("body").append(t),e("html, body").animate({scrollTop:0},"slow"))})}function n(a,i){if("show"===a){var n='<div class="epkb-admin-dialog-box-loading"><div class="epkb-admin-dbl__header"><div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(i?'<div class="epkb-admin-text">'+i+"</div>":"")+'</div></div><div class="epkb-admin-dialog-box-overlay"></div>';e("body").append(n)}else"remove"===a&&(e(".epkb-admin-dialog-box-loading").remove(),e(".epkb-admin-dialog-box-overlay").remove())}function o(){var a=e(".amgp-article-page-categories-container li"),i=[];e(".amgp-article-page-group-container li input").each(function(){e(this).is(":checked")&&i.push(parseInt(e(this).val()))}),a.removeClass("amgp-show-group-cat"),e(".amgp-group-icon-placeholder-container .amgp-group-icon-placeholder").removeClass("amgp-display-group-icon"),e(".amgp-group-icon-placeholder-container").removeClass("amgp-hide-group-icons"),e(".amgp-group-count").remove(),a.each(function(){var a=e(this).data("amgp-group-id");if(void 0!==a)for(var n=JSON.parse("["+a+"]"),o=i.length,t=0;t<=o;t++)-1!==e.inArray(i[t],n)&&(e(this).addClass("amgp-show-group-cat"),e(".amgp-group-icon-placeholder-container .amgp-group-icon-placeholder").each(function(){var a=e(this).data("amgp-group-icon-id");parseInt(i[t])===parseInt(a)&&e(this).addClass("amgp-display-group-icon")}))}),e(".amgp-group-icon-placeholder-container").each(function(){var a=e(this).find(".amgp-display-group-icon").length;a>2&&(e(this).append('<span class="amgp-group-icon-placeholder amgp-group-count">'+a+"</span>"),e(this).addClass("amgp-hide-group-icons"))})}function t(a,i){var n=0;if(!e(a).is(":checked"))var o=parseInt(e(a).val());return e(".amgp-article-page-categories-container li").each(function(){var a=e(this).data("amgp-group-id");if(void 0!==a){var i=JSON.parse("["+a+"]");-1!==e.inArray(o,i)&&e(this).find("input").is(":checked")&&(n+=1)}}),n>0?(i.preventDefault(),e(".amgp-cannot-deselect-group").remove(),e("#amgp-article-page-inner-container").prepend('<div class="amgp-cannot-deselect-group">Un-check assigned Categories</div>'),!1):(e(".amgp-cannot-deselect-group").remove(),!0)}function r(a){e(".amgp-no-categories-detected").remove(),e(a).is(":checked")&&0===e(".amgp-show-group-cat").length&&(e(".amgp-required-category").remove(),e("#amgp-article-page-inner-container").prepend('<div class="amgp-no-categories-detected">No Categories Assigned</div>'))}function c(){if(e("#amgp-group-article-access").length){e(".amgp-required-category").remove(),s("hide"),e("#amgp-article-page-inner-container").prepend('<div class="amgp-required-category">'+amgp_vars.select_at_least_one_category+"</div>");var a=1;e(".amgp-article-page-categories-container").find(" li ").each(function(){e(this).find('input[type="checkbox"]:checked').length&&(a=0)}),0===a&&(s("show"),e(".amgp-required-category").remove())}}function p(){e("#amgp-group-article-access").length&&(e(".amgp-required-group").remove(),e(".amgp-required-category").remove(),m&&clearTimeout(m),m=setTimeout(function(){let a=1;e("#amgp-article-page-inner-container").prepend('<div class="amgp-required-group">'+amgp_vars.select_at_least_one_group+"</div>"),e(".amgp-article-page-group-container").find(" li ").each(function(){e(this).find('input[type="checkbox"]:checked').length&&(a=0)}),s("hide"),0===a&&(e(".amgp-required-group").remove(),c())},1e3))}function s(a){"show"===a?(editor=e(".block-editor #editor"),editor.length>0?wp.data.dispatch("core/editor").unlockPostSaving("amag"):e("#publishing-action [type=submit]").prop("disabled",!1)):"hide"===a&&(editor=e(".block-editor #editor"),editor.length>0?void 0!==wp.data&&wp.data.dispatch("core/editor").lockPostSaving("amag"):e("#publishing-action [type=submit]").prop("disabled","disabled"))}function g(e,a,i){return'<div class="eckb-top-notice-message"><div class="contents"><span class="'+i+'">'+(e?"<h4>"+e+"</h4>":"")+(a||"")+"</span></div></div>"}e("#amgp-ajax-in-progress").dialog({resizable:!1,height:70,width:200,modal:!1,autoOpen:!1}).hide();var l=e("#ekcb-licenses");if(e("#eckb_license_tab").hasClass("active")&&a(),e("#wpbody").on("click","#eckb_license_tab",function(e){a()}),l.on("click","#amgp_save_btn",function(a){a.preventDefault();i("POST",{action:"amgp_handle_license_request",amgp_license_key:e("#amgp_license_key").val().trim(),_wpnonce_amgp_license_key:e("#_wpnonce_amgp_license_key").val(),command:"save"},"Saving license...")}),e("#posts-filter .search-box").after('<input type="hidden" id="amag_chosen_kb_group" name="amag_chosen_kb_group" value="'+e("#amag_chosen_kb_group").val()+'"/>'),e(".amgp-admin-list-page-chosen-group-container").length&&e("#amag_chosen_kb_group").val()){var d="&amag_chosen_kb_group="+e("#amag_chosen_kb_group").val();e(".subsubsub").find("a").each(function(){e(this).attr("href").match("^edit.php\\?")&&e(this).attr("href").match(amgp_vars.match_article_search)&&e(this).attr("href",e(this).attr("href")+d)}),e("#the-list").find("a").each(function(){e(this).attr("href").match("^edit.php\\?")&&e(this).attr("href").match(amgp_vars.match_article_search)&&e(this).attr("href",e(this).attr("href")+d)}),e(".inline-edit-private").after('<input type="hidden" id="amag_chosen_kb_group" name="amag_chosen_kb_group" value="'+e("#amag_chosen_kb_group").val()+'"/>')}let m;e(".amgp-group-icon-placeholder-container").each(function(){let a=e(this).find(".amgp-group-icon-placeholder").length;a>2&&(e(this).append('<span class="amgp-group-icon-placeholder amgp-group-count">'+a+"</span>"),e(this).addClass("amgp-hide-group-icons"))}),e("body").on("click",".amgp-group-count",function(){e(this).parent().toggleClass("amgp-hide-group-icons")});let u=0,h=setInterval(function(){(++u>=5||e("#amgp-group-article-access").length&&e("#amgp-article-page-inner-container").length&&e(".amgp-article-page-categories-container").length&&(e("#submitdiv").length||e(".edit-post-header__settings").length))&&(1===e(".amgp-admin-categories").length?(e(e("#amgp-group-article-access").on("click","input",function(e){c()})),c()):(s("hide"),p(),o(),1===e(".amgp-article-page-group-container li").length&&(e('.amgp-article-page-group-container li input[type="checkbox"]').prop("checked",!0),o()),e(e("#amgp-group-article-access").on("click","input",function(a){t(e(this),a)&&(p(),r(e(this)))})),e(e(".amgp-article-page-group-container").on("click","input",function(a){t(e(this),a)&&(o(),r(e(this)))}))),clearInterval(h))},1e3);if(e("#wpbody").on("click","[id^=amag_chosen_kb_group_article_switch_kb_choice_]",function(a){a.preventDefault(),e(".amag-ajax-loading-saving-icon").length>0||(e(".amag-private-admin").find(".amag-ajax-loading-saving-icon").remove(),e(".amag-private-admin").append('<div class="amag-ajax-loading-saving-icon"><div class="amag-loading-spinner"></div></div>'));!function(a,i,n){var o;e.ajax({type:a,dataType:"json",data:i,url:ajaxurl,beforeSend:function(a){e("#amgp-ajax-in-progress").text(n).dialog("open")}}).done(function(e){(e=e||"").message||void 0===e.amag_chosen_kb_group?o=e.message?e.message:g("","Access Manager: Error occurred. Please try again later. (L01)","error"):window.location.href=window.location.href+"&amag_chosen_kb_group="+e.amag_chosen_kb_group}).fail(function(e,a,i){o=g("Access Manager: Error occurred. Please try again later. (L02)",o=i?" ["+i+"]":"unknown error","error")}).always(function(){e("#amgp-ajax-in-progress").dialog("close"),o&&(e(".eckb-bottom-notice-message").replaceWith(o),e("html, body").animate({scrollTop:0},"slow"))})}("POST",{action:"amgp_switch_kb_group_on_article_page",_wpnonce_amgp_article_switch_kb:e("#_wpnonce_amgp_article_switch_kb").val(),amgp_kb_id:e("#amgp_kb_id").val(),amag_chosen_kb_group:e(this).val()},"Switching KB Group...")}),e(".wp-list-table.posts").on("click",".editinline",function(){e(".wp-list-table.posts").find(".epkb_post_type_1_category-checklist").each(function(){e(this).hide(),e(this).after("<span>Quick edit of categories not available</span>")})}),e(".amgp-admin-list-page-chosen-group-container").length){e(".amgp-radio-checked").length&&e("#col-container").show();var _=e(".amgp-admin-list-page-chosen-group-container").clone();e(".amgp-admin-list-page-chosen-group-container").remove(),e(".wp-heading-inline").after(_)}else e("#col-container").show();e(".amag-private-admin").find(".amgp-admin-list-page-chosen-group-container").fadeIn(),function(){function a(a){var i="#amgp_kb_section_group_id_"+a;e(".amgp_kb_mode").hide(),e(i).show()}var i=e("#amgp-main-page-group-selection");e(".amgp_kb_mode").hide(),i.val()&&a(i.val()),e("body").on("change","#amgp-main-page-group-selection",function(i){a(e(this).val())})}(),e("body").on("click",".amgp_notice_reset_logs_ajax",function(){!function(a,i,n){var o,t,i=void 0===i?"amgp_callback_noop":i;e.ajax({type:"POST",dataType:"json",data:a,url:ajaxurl,beforeSend:function(a){e("#amgp-ajax-in-progress").text("Working ...").dialog("open")}}).done(function(e){((t=e||"").error||void 0===t.message)&&(o=t.message?t.message:g("",amgp_vars.reload_try_again,"error"))}).fail(function(e,a,i){o=i?" ["+i+"]":amgp_vars.unknown_error,o=g(amgp_vars.error_occurred+". "+amgp_vars.msg_try_again,o,"error")}).always(function(){e("#amgp-ajax-in-progress").dialog("close"),o?e(".eckb-bottom-notice-message").replaceWith(o):"function"==typeof i?i(t=void 0===t?"":t):n&&location.reload()})}({action:"amgp_reset_logs_ajax",_wpnonce_epkb_ajax_action:amgr_vars.nonce},null,!0)})});