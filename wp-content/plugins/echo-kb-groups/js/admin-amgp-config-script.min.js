jQuery(document).ready(function(a){function e(e){u.html(),u.html(e.message),a(".amag-config-content").hide(),a("#amgp-kb-groups-content").show()}function n(e,n){d.find("#amag-delete-group-box").on("click","#amag-notification-box-apply-js",function(){var t=0;a(".amag-notification-box").find(" .amag-body-checkboxes li ").each(function(){!a(this).find('input[type="checkbox"]:checked').length>0&&(t=1,a(".eckb-bottom-notice-message").replaceWith(_("","Must check all checkboxes before Deleting group","error")))}),0===t&&(m(),o("amgp_delete_kb_group_ajax",n,e,i),a("#amag-delete-group-box").hide())})}function o(e,n,o,i){var g=t(n,o);if(g)return a(".eckb-bottom-notice-message").replaceWith(g),void a("html, body").animate({scrollTop:0},"slow");l({action:e,amag_kb_id:a("#amag_kb_id").val(),amgp_kb_group_name:o,amgp_kb_group_id:n,_wpnonce_amar_access_content_action_ajax:a("#_wpnonce_amar_access_content_action_ajax").val()},i)}function t(a,e){return!(void 0===e||!e||e.size<3)&&(!(void 0===a||!a||"0"===a)&&"")}function i(){var n={action:"amgp_add_kb_groups_tabs_ajax",amag_kb_id:a("#amag_kb_id").val(),_wpnonce_amar_access_content_action_ajax:a("#_wpnonce_amar_access_content_action_ajax").val()};a("#amgp-delete-group-box").hide(),l(n,e)}function g(e){b.html(),b.html(e.message),a(".amag-config-content").hide(),b.show()}function c(){var e=b.find("#amgp-user-tabs-kb-group-list").find(":selected").val(),n=a("#amgp-users-content .amgp-nav-tabs .amag-active-tab").attr("id");"0"===e&&a(".amgp-user-tabs-container").remove();l({action:"amgp_add_kb_user_roles_tabs_ajax",amag_kb_id:a("#amag_kb_id").val(),amgp_kb_group_id:e,amag_current_page_number:a("#ammgp-page-number").data("page-number"),amgp_active_role:n,_wpnonce_amar_access_content_action_ajax:a("#_wpnonce_amar_access_content_action_ajax").val()},g)}function r(e,n,o,t){var i;if(i=function(a,e,n){if(!e||e.size<3)return _("","Role name is invalid.","error");if(!a||"0"===a)return _("","Select Group first.","error");if("0"===n)return _("","Select User first.","error");return""}(n,o,t))return a(".eckb-bottom-notice-message").replaceWith(i),void a("html, body").animate({scrollTop:0},"slow");l({action:e,amag_kb_id:a("#amag_kb_id").val(),amgp_kb_role_name:o,amgp_wp_user_id:t,amgp_kb_group_id:n,_wpnonce_amar_access_content_action_ajax:a("#_wpnonce_amar_access_content_action_ajax").val()},c)}function s(e){a("#amgp-control-"+e.role).html(),a("#amgp-control-"+e.role).html(e.message)}function p(e){a("#amgp-user-tabs-section").html(e.message)}function l(e,n,o){var t,i,n=void 0===n?"amgp_callback_noop":n;a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(e){a("#amgp-ajax-in-progress").text("Working ...").dialog("open")}}).done(function(a){((i=a||"").error||void 0===i.message)&&(t=i.message?i.message:_("",amgp_vars.reload_try_again,"error"))}).fail(function(a,e,n){t=n?" ["+n+"]":amgp_vars.unknown_error,t=_(amgp_vars.error_occurred+". "+amgp_vars.msg_try_again,t,"error")}).always(function(){a("#amgp-ajax-in-progress").dialog("close"),t?(d.find(".amag-ajax-loading-saving-icon").remove(),a(".eckb-bottom-notice-message").replaceWith(t)):(!function(){if(0!==a(".amag-ajax-loading-saving-icon").length){d.find(".amag-loading-spinner").after('<div class="epkbfa epkbfa-check-circle"></div>'),d.find(".amag-loading-spinner").remove();var e;clearTimeout(e),e=setTimeout(function(){d.find(".amag-ajax-loading-saving-icon").remove()},1e3)}}(),"function"==typeof n?n(i=void 0===i?"":i):o&&location.reload())})}function m(){if(!(a(".amag-ajax-loading-saving-icon").length>0)){d.find(".amag-ajax-loading-saving-icon").remove();d.append('<div class="amag-ajax-loading-saving-icon"><div class="amag-loading-spinner"></div></div>')}}function _(a,e,n){return'<div class="eckb-bottom-notice-message"><div class="contents"><span class="'+n+'">'+(a?"<h4>"+a+"</h4>":"")+(e||"")+'</span></div><div class="amgp-close-notice epkbfa epkbfa-window-close"></div></div>'}var d=a("#amag-access-manager-container"),u=a("#amgp-kb-groups-content"),b=a("#amgp-users-content");d.find("#amgr-config-main-nav").on("click",".amag-nav-button",function(){if(!(a(".amag-ajax-loading-saving-icon").length>0)){var e=a(this).attr("id");"amag-users"===e?(m(),c()):"amag-groups"===e&&(m(),i())}}),u.on("click","#amgp-add-group",function(){a(this).toggleClass("amgp-btn-active"),a("#amgp-add-group-input").fadeToggle().css("display","inline-block")}),u.on("click","#amgp_add_kb_group_ajax",function(){let e=a("#create-group-name").val().trim();m(),o("amgp_add_kb_group_ajax",0,e,i),u.find("#amgp-add-group").removeClass("amgp-btn-active"),u.find("#create-group-name").val(" "),a("#amgp-add-group-input").fadeOut()}),u.on("click",".amag-rename-group-toggle",function(e){e.preventDefault(),a(this).parent().find(".amgp-rename-group-input").fadeToggle().css("display","inline-block")}),u.on("click","[id^=amgp_rename_kb_group_ajax]",function(e){e.preventDefault();let n=a(this).parent().parent().parent().find(".amgp_kb_group_id").val(),t=a(this).parent().parent().find("#rename-group-name"+n).val().trim();m(),o("amgp_rename_kb_group_ajax",n,t,i)}),u.on("click","[id^=amgp-delete-kb-group]",function(){a(".amgp-popup").remove();var e=a(this).parent().find(".amgp_kb_group_id").val(),o=a(this).parent().find(".amgp_kb_group_name").val(),i=t(e,o);if(i)return a(".eckb-bottom-notice-message").replaceWith(i),void a("html, body").animate({scrollTop:0},"slow");!function(e){var n="";if(n+='<div id="'+e.id+'" class="amag-notification-box amag-popup">',n+='<form class="'+e.type+'">',n+='<section class="amag-header"><h3>'+e.header+"</h3></section>",n+='<section class="amag-body">',e.content&&(n+='<div class="amag-body-content">'+e.content+"</div>"),e.checkboxes){n+='<div class="amag-body-checkboxes">';var o=e.checkboxes.length;n+="<ul>";for(var t=0;t<o;t++)n+='<li><label for="checkbox_'+t+'">'+e.checkboxes[t]+'</label><input type="checkbox" name="checkbox_'+t+'" id="checkbox_'+t+'" required></li>';n+="</ul>",n+="</div>"}n+="</section>",n+='<section class="amgp-footer">',n+='<button type="button" id="amag-notification-box-apply-js" class="amag-error-btn">'+e.apply_button+"</button>",e.cancel_button&&(n+='<button type="button" id="amag-notification-box-cancel" class="amag-success-btn">'+e.cancel_button+"</button>"),n+="</section>",n+="</form>",n+="</div>",a("#amag-access-manager-container").append(n),e.apply_function(e.kb_group_name,e.kb_group_id),d.find(".amag-popup").on("click","#amag-notification-box-cancel",function(e){e.preventDefault(),a(".amag-popup").remove()})}({id:"amag-delete-group-box",type:"amag-error",kb_group_name:o,kb_group_id:e,apply_function:n,header:"Deleting Group "+o,content:"<p>Deleting this group will remove all access to all users assigned to this group.</p>",checkboxes:["I understand that all settings assigned to this group will be lost.","I acknowledge that this change is not reversible."],apply_button:"Delete Group",cancel_button:"Cancel"})}),b.on("change","#amgp-user-tabs-kb-group-list",function(){"0"!==a("#amgp-user-tabs-kb-group-list").find(":selected").val()?(m(),c()):a(".amgp-user-tabs-container").remove()}),b.on("click",".amgp_add_kb_group_user_ajax",function(){var e=a("#amgp-user-tabs-kb-group-list").find(":selected").val(),n=a(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),o=a(this).closest(".amgp-user-record").find(".amgp-wp-user-id").val();o>0&&m(),r("amgp_add_kb_group_user_ajax",e,n,o)}),b.on("click",".amgp_remove_kb_group_user_ajax",function(){a(this).attr("disabled","disabled");var e=a(this).parent().parent().find(".amgp-wp-user-id").val(),n=a(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),o=a("#amgp-user-tabs-kb-group-list").find(":selected").val();m(),r("amgp_remove_kb_group_user_ajax",o,n,e)}),b.on("click","a",function(e){e.preventDefault();var n={action:"amgp_get_user_page_ajax",amag_kb_id:a("#amag_kb_id").val(),amgp_kb_group_id:a("#amgp-user-tabs-kb-group-list").find(":selected").val(),amgp_kb_role_name:a(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),amag_current_page_number:a("#ammgp-page-number").data("page-number"),amag_next_page_number:a(this).text(),_wpnonce_amgp_get_user_page_ajax:a("#_wpnonce_amgp_get_user_page_ajax").val()};m(),l(n,s)}),b.on("click","#amgp_filter_users",function(e){e.preventDefault();var n=a(this).closest(".amgp-group-roles").find(".amgp_kb_role_name").val(),o={action:"amgp_filter_users_ajax",amag_kb_id:a("#amag_kb_id").val(),amgp_kb_group_id:a("#amgp-user-tabs-kb-group-list").find(":selected").val(),amgp_kb_role_name:n,amag_user_filter:a("#amgp_user_filter-"+n).val(),_wpnonce_amgp_get_user_page_ajax:a("#_wpnonce_amgp_get_user_page_ajax").val()};m(),l(o,s)}),a("#amgp-access-save-configuration-container").on("click","#amgp_save_kb_config",function(e){e.preventDefault(),m();l({action:"amgp_save_kb_config_changes",amag_kb_id:a("#amag_kb_id").val(),form:a("#amgp-access-configuration").serialize(),_wpnonce_amgp_save_kb_config:a("#_wpnonce_amgp_save_kb_config").val()},p)}),d.find(".amag-notification-box").on("click",".amag-content-toggle",function(){a(this).parents(".amag-collapse").find(".amag-body-checkboxes").fadeToggle(100),a(this).parents(".amag-collapse").find(".amgp-footer").fadeToggle(100),a(this).parents(".amag-collapse").find(".fa").toggleClass("fa-arrow-circle-down fa-arrow-circle-up"),a(this).parents(".amag-collapse").toggleClass("amag-active-toggle")}),d.on("click",".amgp-toggle-box-header",function(){a(this).parent().toggleClass("amgp-toggle-closed amgp-toggle-open "),a(this).find(".amgp-toggle-box-icon").toggleClass("fa-arrow-circle-down fa-arrow-circle-up ")}),d.on("click",".amgp-info-box-icon",function(){a(this).parent().toggleClass("amgp-info-toggle-closed amgp-info-toggle-open ")}),d.on("click",".amgp-info-box-close",function(){a(this).parents(".amgp-info-box").toggleClass("amgp-info-toggle-closed amgp-info-toggle-open ")}),d.on("click",".amgp-info-box-icon-max",function(){a(this).parents(".amgp-info-box").addClass("amgp-info-max-size"),a(this).hide(),a(this).parent().find(".amgp-info-box-icon-min").show()}),d.on("click",".amgp-info-box-icon-min",function(){a(this).parents(".amgp-info-box").removeClass("amgp-info-max-size"),a(this).hide(),a(this).parent().find(".amgp-info-box-icon-max").show()})});