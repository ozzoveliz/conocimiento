jQuery(document).ready(function(a){function e(e){a("#amgr-KB-content").html(),a("#amgr-KB-content").html(e.message),a(".amag-config-content").hide(),a("#amgr-KB-content").show()}function n(){_()}function i(){var e={action:"amgr_display_kb_articles_access_ajax",amgr_kb_group_id:a("#amgr-access-tabs-kb-group-list-articles").find(":selected").val(),amag_kb_id:a("#amag_kb_id").val(),_wpnonce_amar_access_content_action_ajax:a("#_wpnonce_amar_access_content_action_ajax").val()};l(),m(e,t)}function t(e){a("#amgr-articles-content").html(),a("#amgr-articles-content").html(e.message),a(".amag-config-content").hide(),a("#amgr-articles-content").show()}function o(){i()}function c(){var e={action:"amgr_display_kb_category_access_ajax",amgr_kb_group_id:a("#amgr-access-tabs-kb-group-list").find(":selected").val(),amag_kb_id:a("#amag_kb_id").val(),_wpnonce_amar_access_content_action_ajax:a("#_wpnonce_amar_access_content_action_ajax").val()};l(),m(e,s)}function s(e){a("#amgr-categories-content").html(),a("#amgr-categories-content").html(e.message),a(".amag-config-content").hide(),a("#amgr-categories-content").show()}function r(e){a(e).removeClass("amgr-no-access amgr-read-access amgr-full-access ")}function g(){c()}function m(e,n,i){var t,o,n=void 0===n?"amgr_callback_noop":n;a.ajax({type:"POST",dataType:"json",data:e,url:ajaxurl,beforeSend:function(e){a("#amgr-ajax-in-progress").text("Working ...").dialog("open")}}).done(function(a){((o=a||"").error||void 0===o.message)&&(t=o.message?o.message:d("",amgr_vars.reload_try_again,"error"))}).fail(function(a,e,n){t=n?" ["+n+"]":amgr_vars.unknown_error,t=d(amgr_vars.error_occurred+". "+amgr_vars.msg_try_again,t,"error")}).always(function(){a("#amgr-ajax-in-progress").dialog("close"),t?(f.find(".amag-ajax-loading-saving-icon").remove(),a(".eckb-bottom-notice-message").replaceWith(t)):(_(),"function"==typeof n?n(o=void 0===o?"":o):i&&location.reload())})}function l(){if(!(a(".amag-ajax-loading-saving-icon").length>0)){f.find(".amag-ajax-loading-saving-icon").remove();f.append('<div class="amag-ajax-loading-saving-icon"><div class="amag-loading-spinner"></div></div>')}}function _(){if(0!==a(".amag-ajax-loading-saving-icon").length){f.find(".amag-loading-spinner").after('<div class="epkbfa epkbfa-check-circle"></div>'),f.find(".amag-loading-spinner").remove();var e;clearTimeout(e),e=setTimeout(function(){f.find(".amag-ajax-loading-saving-icon").remove()},1e3)}}function d(a,e,n){return'<div class="eckb-bottom-notice-message eckb-bottom-notice-message--'+n+'"><div class="eckb-bottom-notice-message__header"><div class="eckb-bottom-notice-message__header__title">'+(a||e)+'</div><div class="eckb-bottom-notice-message__header__close epkb-close-notice epkbfa epkbfa-window-close"></div> </div>'+(a?'<div class="contents">'+e+"</div>":"")+"</div>"}var f=a("#amag-access-manager-container"),v=a("#amgr-config-container");f.find("#amgr-config-main-nav").on("click",".amag-nav-button",function(){if(!(a(".amag-ajax-loading-saving-icon").length>0)){a(".amgr-nav-section").removeClass("amgr-active-nav"),a(this).addClass("amgr-active-nav"),a(".amag-config-content").removeClass("amag-active-content");var n=a(this).attr("id");a("#amgr-config-container").find("#"+n+"-content").addClass("amag-active-content"),"amgr-categories"===n?(l(),c()):"amgr-articles"===n?(l(),i()):"amgr-KB"===n&&(l(),function(){var n={action:"amgr_display_kb_kbs_access_ajax",amag_kb_id:a("#amag_kb_id").val(),_wpnonce_amar_access_content_action_ajax:a("#_wpnonce_amar_access_content_action_ajax").val()};l(),m(n,e)}())}}),a("#amgr-list-of-kbs").on("change",function(e){l();var n=a(this).find(":selected").data("kb-admin-url");n&&(window.location.href=n)}),f.on("click",".amag-nav-tabs li",function(){if(!(a(".amag-ajax-loading-saving-icon").length>0)){var e=a(this).attr("id");a(this).parent().find("li").removeClass("amag-active-tab"),a(this).parent().parent().find(".amag-tab-panel").removeClass("amag-active-panel"),a(this).addClass("amag-active-tab"),a("#"+e+"-panel").addClass("amag-active-panel")}}),f.on("click","#amgr_reset_logs_ajax",function(){m({action:"amgr_reset_logs_ajax",_wpnonce_epkb_ajax_action:a("[name=_wpnonce_epkb_ajax_action]").val()},null,!0)}),a("body").on("click","#epkb_save_amgr_settings",function(e){e.preventDefault();var i={action:"epkb_save_amgr_settings",_wpnonce_epkb_ajax_action:amgr_vars.nonce,amag_kb_id:a("#amag_kb_id").val(),epkb_prefix_enabled:a("#show_private_article_prefix").is(":checked"),form:a("#epkb-access-config").serialize()};l(),m(i,n)}),v.on("change","#amgr-access-tabs-kb-group-list-articles",function(){i()}),v.on("click","#amgr_save_articles_access_ajax",function(e){e.preventDefault();var n=a(this).parent().parent().find("#amgr_kb_group_id_article_access").val();if(""!==n){l();var i=[];a("#amgr-read-only-article-access").find(".amgr-article-read-only-access").each(function(e,n){i.push(a(this).val()+"="+a(this).is(":checked"))}),function(e,n,i,t){m({action:e,amag_kb_id:a("#amag_kb_id").val(),amgr_kb_group_id:n,amgr_article_data:i,_wpnonce_epkb_ajax_action:amgr_vars.nonce},t)}("amgr_save_articles_access_ajax",n,i,o)}}),v.on("change","#amgr-access-tabs-kb-group-list",function(){c()}),v.on("click",".amgr-edit-mode-container input",function(){v.find(".amgr-edit-mode-container li").removeClass("amgr-edit-active-no amgr-edit-active-full amgr-edit-active-read");var e=a(this).val();a(this).parent().addClass("amgr-edit-active-"+e)}),v.on("click","#amgr-category-access-levels ul>li",function(e){e.stopPropagation();var n="amgr-"+a("input[name=amgr-edit-mode]:checked").val()+"-access";r(this),a(this).addClass(n),a(this).find('>div input[type="hidden"]').attr("data-amgr-category-access-level",n),"amgr-no-access"===n&&(r(a(this).find("li")),a(this).find("li").addClass(n),a(this).find('input[type="hidden"]').attr("data-amgr-category-access-level",n))}),v.on("click","#amgr_save_categories_access_ajax",function(e){e.preventDefault();var n=a(this).parent().parent().find(".amgr_kb_group_id").val();if(""!==n){l();var i=[];a("#amgr-category-access-levels").find("[data-amgr-category-id]").each(function(e,n){i.push(a(this).data("amgr-category-id")+"="+a(this).data("amgr-category-access-level"))}),function(e,n,i,t){m({action:e,amag_kb_id:a("#amag_kb_id").val(),amgr_kb_group_id:n,amgr_category_data:i,_wpnonce_epkb_ajax_action:amgr_vars.nonce},t)}("amgr_save_categories_access_ajax",n,i,g)}});var p;a(document).ajaxComplete(function(){clearTimeout(p),p=setTimeout(function(){var a=f.find(".eckb-bottom-notice-message");a.length&&a.addClass("fadeOutDown")},1e4)}),f.find(".amag-notification-box").on("click",".amag-content-toggle",function(){a(this).parents(".amag-collapse").find(".amag-body-checkboxes").fadeToggle(100),a(this).parents(".amag-collapse").find(".amag-footer").fadeToggle(100),a(this).parents(".amag-collapse").find(".fa").toggleClass("fa-arrow-circle-down fa-arrow-circle-up"),a(this).parents(".amag-collapse").toggleClass("amag-active-toggle")}),f.on("click",".amgr-toggle-box-header",function(){a(this).parent().toggleClass("amgr-toggle-closed amgr-toggle-open "),a(this).find(".amgr-toggle-box-icon").toggleClass("fa-arrow-circle-down fa-arrow-circle-up ")}),f.on("click",".amgr-info-box-icon",function(){a(this).parent().toggleClass("amgr-info-toggle-closed amgr-info-toggle-open ")}),f.on("click",".amgr-info-box-close",function(){a(this).parents(".amgr-info-box").toggleClass("amgr-info-toggle-closed amgr-info-toggle-open ")}),f.on("click",".amgr-info-box-icon-max",function(){a(this).parents(".amgr-info-box").addClass("amgr-info-max-size"),a(this).hide(),a(this).parent().find(".amgr-info-box-icon-min").show()}),f.on("click",".amgr-info-box-icon-min",function(){a(this).parents(".amgr-info-box").removeClass("amgr-info-max-size"),a(this).hide(),a(this).parent().find(".amgr-info-box-icon-max").show()})});