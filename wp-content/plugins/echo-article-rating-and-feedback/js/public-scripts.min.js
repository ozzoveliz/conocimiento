jQuery(document).ready(function(e){function t(t,r=!0){if(e("body").hasClass("epkb-editor-preview"))return!1;o=t,e(".eprf-article-feedback__title").show(),e(".eprf-article-feedback__required-title").hide();let i=!1;if(e(".eprf-like-dislike-module").hasClass("eprf-like-dislike-module-required-negative-five")&&t<5&&(i=!0),e(".eprf-stars-module").hasClass("eprf-stars-module-required-negative-four")&&t<4&&(i=!0),e(".eprf-stars-module").hasClass("eprf-stars-module-required-negative-five")&&t<5&&(i=!0),i&&r)return e(".eprf-article-feedback__title").hide(),e(".eprf-article-feedback__required-title").show(),e(document.body).trigger("open_article_feedback_form"),!1;let a=e("#eckb-article-content").data("article-id");if(void 0===a)return!1;var s={action:"eprf-update-rating",article_id:a,rating_value:t};s._wpnonce_eprf_ajax_action=eprf_vars.nonce,e.ajax({type:"GET",dataType:"json",data:s,url:eprf_vars.ajaxurl,beforeSend:function(e){}}).done(function(i){r&&(e("#eprf-current-rating").html(i.message),t>0&&e(".eprf-article-feedback-container--trigger-user-votes").length&&e(document.body).trigger("open_article_feedback_form"),t<5&&e(".eprf-article-feedback-container--trigger-negative-five").length&&e(document.body).trigger("open_article_feedback_form"),t<4&&e(".eprf-article-feedback-container--trigger-negative-four").length&&e(document.body).trigger("open_article_feedback_form"),t<4&&e(".eprf-article-feedback-container--trigger-dislike").length&&e(document.body).trigger("open_article_feedback_form")),e(".eprf-stars-container").length&&(e(".eprf-stars-container").data("average",t).trigger("update_view"),e(".eprf-stars-container").addClass("disabled")),void 0!==i.rating&&(e(".eprf-like-dislike-module__buttons").length&&void 0!==i.rating.statistic&&i.rating.statistic&&(e(".eprf-like-count").text(i.rating.statistic.like),e(".eprf-dislike-count").text(i.rating.statistic.dislike)),e(".eprf-stars-module__statistics").length&&void 0!==i.statistics&&i.rating.statistic&&e(".eprf-stars-module__statistics").html(i.statistics),e(".eprf-article-meta__statistics").length&&void 0!==i.statistics&&i.rating.statistic&&e(".eprf-article-meta__statistics").html(i.statistics)),e("body").find(".eprf-stars-container.disabled").css({cursor:"default"}),e(".epkbfa-star").on("click",!1),e("body").find(".eprf-like-dislike-module__buttons .eprf-rate-like, .eprf-like-dislike-module__buttons .eprf-rate-dislike").css({cursor:"default"}),e("body").find(".eprf-like-dislike-module__buttons .eprf-rate-like, .eprf-like-dislike-module__buttons .eprf-rate-dislike").on("click",!1),e(".eprf-like-dislike-module").addClass("eprf-rating--blocked")}).fail(function(e,t,r){msg=eprf_vars.msg_try_again+". ["+(r||eprf_vars.unknown_error)+"]"})}function r(t,r){t.find(".eprf-stars__top-lay").hide(),t.find(".eprf-stars__inner-background .epkbfa").removeClass("epkbfa-star").removeClass("epkbfa-star-o").removeClass("epkbfa-star-half-o"),$i=0,t.find(".eprf-stars__inner-background .epkbfa").each(function(){r>=$i+1?e(this).addClass("epkbfa-star").removeClass("epkbfa-star-o").removeClass("epkbfa-star-half-o"):r>=$i+.5?e(this).removeClass("epkbfa-star").removeClass("epkbfa-star-o").addClass("epkbfa-star-half-o"):e(this).removeClass("epkbfa-star").addClass("epkbfa-star-o").removeClass("epkbfa-star-half-o"),e(this).removeClass("epkbfa-star--selected"),r==$i+1&&e(this).addClass("epkbfa-star--selected"),$i++})}function i(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function a(){let t=e(".eprf-stars-container");t.data("average",d).trigger("update_view"),c.innerText=d.toFixed(1),r(t,d),l.disabled=d<=1,f.disabled=d>=5}function s(t){const r=r=>{$target=e(r.target),$target.closest(t).length||$target.hasClass("eprf-show-statistics-toggle")||$target.hasClass("eprf-article-meta__statistics-toggle")||!e(t).is(":visible")||(e(t).hide(),i())},i=()=>{document.removeEventListener("click",r)};document.addEventListener("click",r)}function n(t,r){let i=t.pageX-e(r).offset().left;return e("[dir=rtl]").length&&(i=e(r).width()-t.pageX+e(r).offset().left),Math.round(i/e(r).width()*10)/2}let o=-1;e(".eprf-like-dislike-module:not(.eprf-rating--blocked) .eprf-rate-like").on("click",function(){if(!e("body").hasClass("epkb-editor-preview"))return e(this).closest(".eprf-like-dislike-module").hasClass("eprf-rating--blocked")||t(5),!1}),e(".eprf-like-dislike-module:not(.eprf-rating--blocked) .eprf-rate-dislike").on("click",function(){if(!e("body").hasClass("epkb-editor-preview"))return e(this).closest(".eprf-like-dislike-module").hasClass("eprf-rating--blocked")||t(1),!1}),e(document.body).on("click",".eprf-show-statistics-toggle",function(){if(!e("body").hasClass("epkb-editor-preview")){var t,r,i=e(".eprf-stars-container");t=i.position().top+i.height(),r=i.position().left+i.width()/2;var a=e(".eprf-stars-module .eprf-stars-module__statistics");a.css({left:r-a.width()/2+"px",top:t+5+"px"})}}),e(document.body).on("click",".eprf-show-statistics-toggle",function(){if(e("body").hasClass("epkb-editor-preview"))return;let t=e(".eprf-stars-module .eprf-stars-module__statistics");t.toggle(),e(t).is(":visible")&&s(t)}),e(document.body).on("click",".eprf-article-meta__statistics-toggle",function(){if(e("body").hasClass("epkb-editor-preview"))return;let t=e(this).parent().find(".eprf-article-meta__statistics");t.toggle(),e(t).is(":visible")&&s(t)}),e(document.body).on("open_article_feedback_form",function(){e(".eprf-article-feedback-container--trigger-user-votes").length?e(".eprf-article-feedback-container--trigger-user-votes").slideDown():e(".eprf-article-feedback-container--trigger-negative-four").length?e(".eprf-article-feedback-container--trigger-negative-four").slideDown():e(".eprf-article-feedback-container--trigger-negative-five").length?e(".eprf-article-feedback-container--trigger-negative-five").slideDown():e(".eprf-article-feedback-container--trigger-dislike").length?e(".eprf-article-feedback-container--trigger-dislike").slideDown():e(".eprf-stars-module-required-negative-five, .eprf-stars-module-required-negative-four")?e("#eprf-article-feedback-container").slideDown():e(".eprf-form-row").slideDown(),e("#eprf-article-feedback-container button").addClass("openned"),e(".eprf-open_feedback_form").hide()}),e(".eprf-leave-feedback-form").on("submit",function(){if(e("body").hasClass("epkb-editor-preview"))return!1;let r=e("#eckb-article-content").data("article-id");if(void 0===r)return!1;var i={action:"eprf-add-comment",article_id:r,current_vote:o,name:"",email:"",comment:"",catch_details:""};return i._wpnonce_eprf_ajax_action=eprf_vars.nonce,e("#eprf-form-name").length&&(i.name=e("#eprf-form-name").val()),e("#eprf-form-email").length&&(i.email=e("#eprf-form-email").val()),e("#eprf-form-text").length&&(i.comment=e("#eprf-form-text").val()),e("#eprf-form-details").length&&(i.catch_details=e("#eprf-form-details").val()),e.ajax({type:"GET",dataType:"json",data:i,url:eprf_vars.ajaxurl,beforeSend:function(t){e("#eprf-current-rating").html('<div class="eprf-article-buttons__feedback-confirmation__loading"><div class="eprf-article-buttons__feedback-confirmation__loading__icon epkbfa epkbfa-spinner"></div> '+e("#eprf-current-rating").data("loading")+"</div>")}}).done(function(r){e("#eprf-current-rating").html(r.message),e("#eprf-article-feedback-container").slideUp(),e(".eprf-open_feedback_form").hide(),"success_1"!=r.status&&(e(".eprf-stars-container").length&&!e(".eprf-stars-container").hasClass("disabled")&&0==e(".eprf-stars-container").closest(".eprf-rating--blocked").length&&t(e(".eprf-stars-container").data("average"),!1),e(".eprf-like-dislike-module").length&&!e(".eprf-like-dislike-module").hasClass("eprf-rating--blocked")&&t(1,!1))}).fail(function(e,t,r){msg=eprf_vars.msg_try_again+". ["+(r||eprf_vars.unknown_error)+"]"}),!1}),e(document.body).on("update_view mouseout",".eprf-stars-container",function(t){if(!e(this).hasClass("disabled")&&!i()){let t=e(this).data("average");r(e(this),t)}}),e(document.body).on("mousemove",".eprf-stars-container",function(t){if(!e(this).hasClass("disabled")&&0==e(this).closest(".eprf-rating--blocked").length&&!i()){let i=n(t,this);r(e(this),i)}});const l=document.querySelector(".eprf-mobile-rating-btn.eprf-decrease"),f=document.querySelector(".eprf-mobile-rating-btn.eprf-increase"),c=document.querySelector(".eprf-mobile-rating-value");let d;c&&(d=parseFloat(c.innerText)),l&&l.addEventListener("click",function(){d>1&&(d-=.5,a())}),f&&f.addEventListener("click",function(){d<5&&(d+=.5,a())}),l&&f&&c&&d&&a(),e(document.body).on("click",".eprf-stars-container",function(a){if(!e(this).hasClass("disabled")&&0==e(this).closest(".eprf-rating--blocked").length)if(i())setTimeout(function(){let t=e(".eprf-stars-module__mobile-rating");e(t).is(":visible")?e(t).hide():e(t).show()},10);else{let i=n(a,this);e(this).data("average",i).trigger("update_view"),r(e(this),i),t(i)}}),e(document.body).on("click",".eprf-stars-module__mobile-rating .eprf-mobile-rating__submit",function(r){t(d),e(".eprf-stars-module__mobile-rating").hide()}),e(".eprf-stars-container").length&&e(".eprf-stars-container").trigger("update_view"),e(document.body).on("click",".eprf-leave-feedback-form--close",function(t){if(e("#eprf-article-feedback-container").hasClass("eprf-article-feedback-container--trigger-always"))return;let r=e(this).closest("#eprf-article-feedback-container");r.hide(),e(".eprf-open_feedback_form").show();let i=r.parent().find(".eprf-stars-container");0!=i.length&&i.data("average",i.data("initial_average")).trigger("update_view")}),e(document.body).on("click",".eprf-open_feedback_form",function(){return e(document.body).trigger("open_article_feedback_form"),!1})});